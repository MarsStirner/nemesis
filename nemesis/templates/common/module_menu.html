{%  macro make_module_menu(menu_struct) -%}
    <div class="application_menu">
        <div class="navbar navbar-default">
{#                <div class="collapse navbar-collapse">#}
            <ul class="nav navbar-nav">
                {% for menu_item in menu_struct -%}
                    {% if 'url' in menu_item %}
                        {{ _make_menu_item(menu_item) }}
                    {% elif 'subitems' in menu_item %}
                        {# FIXME id numeration #}
                        {{ _make_dropdown_menu_item(menu_item, loop.index) }}
                    {% endif %}
                {%- endfor %}
            </ul>
{#                </div>#}
        </div>
    </div>
{%- endmacro %}

{% macro _make_menu_item(menu_item) -%}
    {% from 'common/utils.html' import mark_active %}
    {% if 'restrict_access' not in menu_item
          or ('restrict_access' in menu_item and current_user.role == 'admin') %}
        <li{{ mark_active(menu_item.get('url')) }}>
            <a href="{{ url_for(menu_item.get('url')) }}">{{ menu_item.get('name') }}</a>
        </li>
    {% endif %}
{%- endmacro %}

{% macro _make_dropdown_menu_item(menu_item, idx) -%}
    {% from 'common/utils.html' import mark_active %}
    {% if 'restrict_access' not in menu_item
          or ('restrict_access' in menu_item and current_user.role == 'admin') %}
        <li class="dropdown">
            <a id="drop" + idx class="dropdown-toggle" data-toggle="dropdown" role="button">
                {{ menu_item.get('name') }} <b class="caret"></b>
            </a>
            <ul class="dropdown-menu" role="menu" aria-labelledby="drop1">
                {% for subitem in menu_item.get('subitems') %}
                     {{ _make_menu_item(subitem) }}
                {% endfor %}
            </ul>
        </li>
    {% endif %}
{%- endmacro %}